<p>From 1.15 onwards, <strong>Charmed Kubernetes</strong> uses <strong>containerd</strong> as part of a pluggable architecture for
container runtimes, instead of directly using Docker only. This change has been
demonstrated to increase performance, and also provides scope for using different
runtimes on a case-by case basis.</p>

<p>However, it is also possible to use Docker for running containers as in previous versions
of <strong>Charmed Kubernetes</strong>.</p>

<h2 id="configuring-containerd">Configuring containerd</h2>

<p>Settings which require additional explanation are described below.</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>custom_registries:</td>
      <td>json</td>
      <td>’[]’</td>
      <td>Setting this config allows images to be pulled from registries requiring auth. <a href="#custom-registries">See below</a>.</td>
    </tr>
    <tr>
      <td>enable-cgroups</td>
      <td>bool</td>
      <td>False</td>
      <td>WARNING changing this option will reboot the host - <a href="#enable-cgroups">see notes</a>.</td>
    </tr>
    <tr>
      <td>extra-packages</td>
      <td>string</td>
      <td>””</td>
      <td>Space separated list of extra deb packages to install.</td>
    </tr>
    <tr>
      <td>gpu-driver</td>
      <td>string</td>
      <td>‘auto’</td>
      <td>Override GPU driver installation.  Options are “auto”, “nvidia”, “none”.</td>
    </tr>
    <tr>
      <td>http_proxy</td>
      <td>string</td>
      <td>””</td>
      <td>URL to use for HTTP_PROXY: useful in egress-filtered environments where a proxy is the only option for accessing the registry to pull images.</td>
    </tr>
    <tr>
      <td>https_proxy</td>
      <td>string</td>
      <td>””</td>
      <td>URL to use for HTTP_PROXY: useful in egress-filtered environments where a proxy is the only option for accessing the registry to pull images.</td>
    </tr>
    <tr>
      <td>install_keys</td>
      <td>string</td>
      <td>””</td>
      <td>List of signing keys for install_sources package sources - <a href="#install-keys">see notes</a></td>
    </tr>
    <tr>
      <td>install_sources</td>
      <td>string</td>
      <td>””</td>
      <td>List of extra apt sources - <a href="#install-sources.">See notes</a></td>
    </tr>
    <tr>
      <td>no_proxy</td>
      <td>string</td>
      <td>””</td>
      <td>Comma-separated list of destinations (either domain names or IP addresses) which should be accessed directly, rather than through the proxy defined in http_proxy or https_proxy. Must be less than 2023 characters long.</td>
    </tr>
    <tr>
      <td>package_status</td>
      <td>string</td>
      <td>‘install’</td>
      <td>The status of service-affecting packages will be set to this value in the dpkg database. Valid values are “install” and “hold”.</td>
    </tr>
    <tr>
      <td>runtime</td>
      <td>string</td>
      <td>‘auto’</td>
      <td>Set a custom containerd runtime.  Set “auto” to select based on hardware.</td>
    </tr>
    <tr>
      <td>shim</td>
      <td>string</td>
      <td>‘containerd-shim’</td>
      <td>Set a custom containerd shim.</td>
    </tr>
  </tbody>
</table>

<h3 id="checking-the-current-configuration">Checking the current configuration</h3>

<p>To check the current configuration settings for containerd, run the command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju config containerd
</code></pre></div></div>

<h3 id="setting-a-config-option">Setting a config option</h3>

<p>To set an option, simply run the config command with and additional <code class="highlighter-rouge">&lt;key&gt;=&lt;value&gt;</code> argument. For example, to explicitly turn off the nvidia driver:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju config containerd <span class="nv">gpu_driver</span><span class="o">=</span>none
</code></pre></div></div>

<h2 id="migrating-to-containerd">Migrating to containerd</h2>

<p>If you have upgraded to  <strong>Charmed Kubernetes</strong> version 1.15, you can transition to using containerd by following the steps outlined in
<a href="/kubernetes/docs/upgrade-notes#1.15">this section of the upgrade notes</a>.</p>

<h2 id="using-docker">Using Docker</h2>

<p>Although the default set up for <strong>Charmed Kubernetes</strong> from version 1.15 is to use containerd to provide the container runtime, it is also possible to
run workers specifically using Docker. This is done by adding the Docker
charm to your cluster and deploying Docker-based workers:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju deploy cs:~containers/kubernetes-worker kubernetes-worker-docker
juju deploy cs:~containers/docker
juju relate docker kubernetes-worker-docker
</code></pre></div></div>

<!-- LINKS -->

<!-- FEEDBACK -->
<div class="p-notification--information">
  <p class="p-notification__response">
    We appreciate your feedback on the documentation. You can 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/edit/master/pages/k8s/container-runtime.md" class="p-notification__action">edit this page</a> 
    or 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/issues/new" class="p-notification__action">file a bug here</a>.
  </p>
</div>
