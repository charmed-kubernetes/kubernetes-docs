<p>Installing <strong>Charmed Kubernetes</strong> on a single machine is possible for the
purposes of testing and development.</p>

<p>However, be aware that the full deployment of <strong>Charmed Kubernetes</strong> has system
requirements which may exceed a standard laptop or desktop machine. It is only
recommended for a machine with 32GB RAM and 250GB of SSD storage.</p>

<div class="p-notification--positive"><p class="p-notification__response">
<span class="p-notification__status">Note:</span>
If you don’t meet these requirements or want a lightweight way to develop on
pure Kubernetes, we recommend  <a href="https://microk8s.io/">microk8s</a>
</p></div>

<p>In order to run locally, you will need a local cloud. This can be achieved by
using lightweight containers managed by <a href="https://linuxcontainers.org/">LXD</a>. <strong>LXD</strong> version 3.0
or better is required.</p>

<h2 id="1-set-up-lxd">1. Set up LXD</h2>

<h3 id="if-lxd-has-not-previously-been-installed">If LXD has not previously been installed</h3>

<p>LXD 3.0 or above should be installed from a <a href="https://snapcraft.io/docs/installing-snapd">snap</a> and configured
for <strong>Charmed Kubernetes</strong></p>

<h4 id="install-lxd">Install LXD</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>snap <span class="nb">install </span>lxd
</code></pre></div></div>

<h4 id="run-the-lxd-init-script">Run the LXD init script</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/snap/bin/lxd init
</code></pre></div></div>

<p>The init script itself may vary depending on the version of LXD. The important
configuration options for the installer are:</p>

<ul>
  <li>Networking: Do <strong>NOT</strong> enable ipv6 networking on the bridge interface</li>
  <li>Storage Pool: Use the ‘dir’ storage type</li>
</ul>

<p>You can now move on to the <a href="#step2">next step</a></p>

<h3 id="if-lxd-is-already-installed">If <strong>LXD</strong> is already installed</h3>

<p>If you installed LXD from a snap, you can skip this step (but if necessary, you may need to alter the <a href="#profile">default profile</a>). If your system
had LXD pre-installed, or you have installed it from the archive (i.e. with
<code class="highlighter-rouge">apt install</code>), you will need to migrate to the snap version.</p>

<p>If you aren’t sure whether LXD is installed, you can check
installed snaps with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>snap list | <span class="nb">grep </span>lxd
</code></pre></div></div>

<p>and installed deb packages with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dpkg <span class="nt">-s</span> lxd |  <span class="nb">grep </span>Status
</code></pre></div></div>

<p>If you do have the deb version of LXD installed, you should migrate to the
snap version after it has been installed. The snap includes a script to do this
for you:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>snap <span class="nb">install </span>lxd
<span class="nb">sudo</span> /snap/bin/lxd.migrate
</code></pre></div></div>

<p>This will move all container specific data to the snap version and clean up
the unused Debian packages, which may take a few minutes.</p>

<p>If LXD was installed, but never used, there will be no data in the default
profile, so you should now initialise LXD:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>lxd init
</code></pre></div></div>

<p><a id="profile"></a></p>

<p>Currently, <strong>Charmed Kubernetes</strong> only supports <code class="highlighter-rouge">dir</code> as a storage option and
does not support ipv6, which should be set to <code class="highlighter-rouge">none</code> from the init script.
Additional profiles will be added automatically to LXD to support the
requirements of <strong>Charmed Kubernetes</strong>.</p>

<p><a id="step2"></a></p>

<h2 id="2-install-juju">2. Install <strong>Juju</strong></h2>

<p><a href="https://jaas.ai">Juju</a> should be installed from a snap:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>snap <span class="nb">install </span>juju <span class="nt">--classic</span>
</code></pre></div></div>

<p>Juju comes preconfigured to work with LXD. A cloud created by using LXD
containers on the local machine is known as <code class="highlighter-rouge">localhost</code> to Juju. To begin, you
need to create a Juju controller for this cloud:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju bootstrap localhost
</code></pre></div></div>

<p>Juju creates a default model, but it is useful to create a new model for each
project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju add-model k8s
</code></pre></div></div>

<h2 id="3-deploy-charmed-kubernetes">3. Deploy <strong>Charmed Kubernetes</strong></h2>

<p>All that remains is to deploy <strong>Charmed Kubernetes</strong>. A simple install can be achieved with one command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju deploy charmed-kubernetes
</code></pre></div></div>

<p>This will install the latest stable version of <strong>Charmed Kubernetes</strong> with
the default components and configuration. If you wish to customise this install
(which may be helpful if you are close to the system requirements), please see
the <a href="/kubernetes/docs/install-manual">main install page</a>.</p>

<h2 id="next-steps">Next Steps</h2>

<p>Now you have a cluster up and running, check out the
<a href="/kubernetes/docs/operations">Operations guide</a> for how to use it!</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="i-get-an-error-message-when-running-lxc-or-lxd-init">I get an error message when running lxc or lxd init</h3>

<p>The most common cause of this message:</p>

<pre><code class="language-no-highlight">Error: Get http://unix.socket/1.0: dial unix /var/snap/lxd/common/lxd/unix.socket: connect: permission denied
</code></pre>

<p>…is that either you have not run <code class="highlighter-rouge">lxd init</code>, or you are logged in as a user
who is not part of the <code class="highlighter-rouge">lxd</code> group (the user installing the snap is
automatically added).</p>

<p>To add the current user to the relevant group:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>usermod <span class="nt">-a</span> <span class="nt">-G</span> lxd <span class="nv">$USER</span>
</code></pre></div></div>

<p>You may need to start a new shell (or logout and login) for this to take effect:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>newgrp lxd
</code></pre></div></div>

<!-- LINKS -->

<!-- FEEDBACK -->
<div class="p-notification--information">
  <p class="p-notification__response">
    We appreciate your feedback on the documentation. You can 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/edit/master/pages/k8s/install-local.md" class="p-notification__action">edit this page</a> 
    or 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/issues/new" class="p-notification__action">file a bug here</a>.
  </p>
</div>
