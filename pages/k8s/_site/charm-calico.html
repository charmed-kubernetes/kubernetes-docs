<p>Calico is a new approach to virtual networking and network security for containers,
VMs, and bare metal services, that provides a rich set of security enforcement
capabilities running on top of a highly scalable and efficient virtual network fabric.</p>

<p>This charm will deploy calico as a background service, and configure CNI for
use with calico, on any principal charm that implements the <a href="https://github.com/juju-solutions/interface-kubernetes-cni">kubernetes-cni</a>
interface.</p>

<h2 id="usage">Usage</h2>

<p>The calico charm is a <a href="https://docs.jujucharms.com/2.4/en/authors-subordinate-applications">subordinate</a>. This charm will require a principal charm
that implements the <code class="highlighter-rouge">kubernetes-cni</code> interface in order to properly deploy.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju deploy cs:~containers/calico
juju deploy cs:~containers/etcd
juju deploy cs:~containers/kubernetes-master
juju deploy cs:~containers/kubernetes-worker
juju add-relation calico etcd
juju add-relation calico kubernetes-master
juju add-relation calico kubernetes-worker
</code></pre></div></div>

<!-- CONFIG STARTS -->
<!--AUTOGENERATED CONFIG TEXT - DO NOT EDIT -->

<p>| name | type   | Default      | Description                               |
|——|——–|————–|——————————————-|
| <a id="table-calico-node-image"> </a> calico-node-image | string | <a href="#calico-node-image-default">See notes</a> | The image id to use for calico/node.
  |
| <a id="table-calico-policy-image"> </a> calico-policy-image | string | <a href="#calico-policy-image-default">See notes</a> | The image id to use for calico/kube-controllers.
  |
| <a id="table-cidr"> </a> cidr | string | 192.168.0.0/16 | <a href="#cidr-description">See notes</a>  |
| <a id="table-global-as-number"> </a> global-as-number | int | 64512 | Global AS number.
  |
| <a id="table-global-bgp-peers"> </a> global-bgp-peers | string | [] | <a href="#global-bgp-peers-description">See notes</a>  |
| <a id="table-ipip"> </a> ipip | string | Never | IPIP mode. Must be one of “Always”, “CrossSubnet”, or “Never”.
  |
| <a id="table-manage-pools"> </a> manage-pools | boolean | True | <a href="#manage-pools-description">See notes</a>  |
| <a id="table-nat-outgoing"> </a> nat-outgoing | boolean | True | NAT outgoing traffic
  |
| <a id="table-node-to-node-mesh"> </a> node-to-node-mesh | boolean | True | When enabled, each Calico node will peer with every other Calico node in
the cluster.
  |
| <a id="table-route-reflector-cluster-ids"> </a> route-reflector-cluster-ids | string | {} | <a href="#route-reflector-cluster-ids-description">See notes</a>  |
| <a id="table-subnet-as-numbers"> </a> subnet-as-numbers | string | {} | <a href="#subnet-as-numbers-description">See notes</a>  |
| <a id="table-subnet-bgp-peers"> </a> subnet-bgp-peers | string | {} | <a href="#subnet-bgp-peers-description">See notes</a>  |
| <a id="table-unit-as-numbers"> </a> unit-as-numbers | string | {} | <a href="#unit-as-numbers-description">See notes</a>  |
| <a id="table-unit-bgp-peers"> </a> unit-bgp-peers | string | {} | <a href="#unit-bgp-peers-description">See notes</a>  |</p>

<hr />

<h3 id="calico-node-image">calico-node-image</h3>

<p><a id="calico-node-image-default"> </a>
<strong>Default:</strong></p>

<p>rocks.canonical.com:443/cdk/calico/node:v3.10.1</p>

<p><a href="#table-calico-node-image">Back to table</a></p>

<h3 id="calico-policy-image">calico-policy-image</h3>

<p><a id="calico-policy-image-default"> </a>
<strong>Default:</strong></p>

<p>rocks.canonical.com:443/cdk/calico/kube-controllers:v3.10.1</p>

<p><a href="#table-calico-policy-image">Back to table</a></p>

<h3 id="cidr">cidr</h3>

<p><a id="cidr-description"> </a>
<strong>Description:</strong></p>

<p>Network CIDR assigned to Calico. This is applied to the default Calico
pool, and is also communicated to the Kubernetes charms for use in
kube-proxy configuration.</p>

<p><a href="#table-cidr">Back to table</a></p>

<h3 id="global-bgp-peers">global-bgp-peers</h3>

<p><a id="global-bgp-peers-description"> </a>
<strong>Description:</strong></p>

<p>List of global BGP peers. Each BGP peer is specified with an address and
an as-number.</p>

<p>Example value: “[{address: 10.0.0.1, as-number: 65000}, {address: 10.0.0.2, as-number: 65001}]”</p>

<p><a href="#table-global-bgp-peers">Back to table</a></p>

<h3 id="manage-pools">manage-pools</h3>

<p><a id="manage-pools-description"> </a>
<strong>Description:</strong></p>

<p>If true, a default pool is created using the cidr and ipip charm
configuration values.</p>

<p>Warning: When manage-pools is enabled, the charm will delete any pools
that are unrecognized.</p>

<p><a href="#table-manage-pools">Back to table</a></p>

<h3 id="route-reflector-cluster-ids">route-reflector-cluster-ids</h3>

<p><a id="route-reflector-cluster-ids-description"> </a>
<strong>Description:</strong></p>

<p>Mapping of unit IDs to route reflector cluster IDs. Assigning a route
reflector cluster ID allows the node to function as a route reflector.</p>

<p>Example value: “{0: 224.0.0.1, 2: 224.0.0.1}”</p>

<p><a href="#table-route-reflector-cluster-ids">Back to table</a></p>

<h3 id="subnet-as-numbers">subnet-as-numbers</h3>

<p><a id="subnet-as-numbers-description"> </a>
<strong>Description:</strong></p>

<p>Mapping of subnets to AS numbers, specified as YAML. Each Calico node
will be assigned an AS number based on the entries in this mapping.</p>

<p>Example value: “{10.0.0.0/24: 64512, 10.0.1.0/24: 64513}”</p>

<p>If a node’s IP matches any of the specified subnets, then the
corresponding AS number is used instead of the global one.</p>

<p>If a node’s IP matches no subnets, then the global AS number will be
used instead.</p>

<p>If a node’s IP matches multiple subnets, then the most specific subnet
will be used, e.g. a /24 subnet will take precedence over a /16.</p>

<p><a href="#table-subnet-as-numbers">Back to table</a></p>

<h3 id="subnet-bgp-peers">subnet-bgp-peers</h3>

<p><a id="subnet-bgp-peers-description"> </a>
<strong>Description:</strong></p>

<p>Mapping of subnets to lists of BGP peers. Each BGP peer is specified with
an address and an as-number.</p>

<p>Example value: “{10.0.0.0/24: [{address: 10.0.0.1, as-number: 65000}, {address: 10.0.0.2, as-number: 65001}], 10.0.1.0/24: [{address: 10.0.1.1, as-number: 65002}]}”</p>

<p>If a node’s IP matches multiple subnets, then peerings will be added for
each matched subnet.</p>

<p><a href="#table-subnet-bgp-peers">Back to table</a></p>

<h3 id="unit-as-numbers">unit-as-numbers</h3>

<p><a id="unit-as-numbers-description"> </a>
<strong>Description:</strong></p>

<p>Mapping of unit IDs to AS numbers, specified as YAML. Each Calico node
will be assigned an AS number based on the entries in this mapping.</p>

<p>Example value: “{0: 64512, 1: 64513}”</p>

<p>This takes precedence over global-as-number and subnet-as-numbers.</p>

<p><a href="#table-unit-as-numbers">Back to table</a></p>

<h3 id="unit-bgp-peers">unit-bgp-peers</h3>

<p><a id="unit-bgp-peers-description"> </a>
<strong>Description:</strong></p>

<p>Mapping of unit IDs to lists of BGP peers. Each BGP peer is specified
with an address and an as-number.</p>

<p>Example value: “{0: [{address: 10.0.0.1, as-number: 65000}, {address: 10.0.0.2, as-number: 65001}], 1: [{address: 10.0.1.1, as-number: 65002}]}”</p>

<p><a href="#table-unit-bgp-peers">Back to table</a></p>

<!-- CONFIG ENDS -->

<h2 id="further-information">Further information</h2>

<ul>
  <li><a href="https://www.projectcalico.org/">Calico Homepage</a></li>
</ul>
