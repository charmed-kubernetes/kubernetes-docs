<p>Decommissioning a cluster requires only a few commands, but beware that it will irretrievably destroy the cluster, its workloads and any information that was stored within. Before proceeding, it is important to verify that you:</p>

<ul>
  <li>Have the correct details for the cluster you wish to decommission</li>
  <li>Have retrieved any valuable data from the cluster</li>
</ul>

<h2 id="destroying-the-model">Destroying the model</h2>

<p>It is always preferable to use a new <strong>Juju</strong> <em>model</em> for each <strong>Kubernetes</strong> cluster. Removing the model is then a simple operation.</p>

<p>It is useful to list all the current models to make sure you are about to destroy the correct one:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju models
</code></pre></div></div>

<p>This will list all the models running on the current controller, for example:</p>

<pre><code class="language-no-highlight">Controller: k8s-controller

Model           Cloud/Region   Status     Machines  Cores  Access  Last connection
controller      aws/us-east-1  available   1          4     admin   just now
default         aws/us-east-1  available   0          -     admin   8 hours ago
k8s-devel       aws/us-east-1  available   9         24     admin   3 hours ago
k8s-production  aws/us-east-1  available  12         28     admin   5 minutes ago
k8s-testing     aws/us-east-1  available   9         24     admin   2 hours ago
</code></pre>

<p>To proceed, use the <code class="highlighter-rouge">juju destroy-model</code> command to target the model you wish to remove. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> juju destroy-model k8s-testing
</code></pre></div></div>

<p>You will see a warning, and be required to confirm the action. <strong>Juju</strong> will then continue to free up the resources, giving feedback on the process. It may take some minutes to complete depending on the size of the deployed model and the nature of the cloud it is running on.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARNING! This command will destroy the "k8s-testing" model.
This includes all machines, applications, data and other resources.

Continue [y/N]? y
Destroying model
Waiting on model to be removed, 7 machine(s), 4 application(s)...
Waiting on model to be removed, 6 machine(s)...
...
Waiting on model to be removed, 3 machine(s)...
Waiting on model to be removed...
Model destroyed.
</code></pre></div></div>

<p>You should confirm that the cloud instances have been terminated with the relevant cloud console/utilities.</p>

<h2 id="destroying-a-controller">Destroying a controller</h2>

<p>If there are no longer any cluster models attached to the controller, you may wish to remove the controller instance as well. This is performed with a similar command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>juju destroy-controller &lt;controller-name&gt;
</code></pre></div></div>

<p>As previously, there is a confirmation step to make sure you wish to remove the controller.</p>

<p>The command will return an error if there are populated models still attached to the controller.</p>

<h2 id="removingediting-kube-config">Removing/editing Kube config</h2>

<p>If you have permanently removed clusters, it is also advisable to remove their entries in the <strong>Kubernetes</strong> configuration file (or remove the file entirely if you have removed all the clusters).</p>

<p>By default the file is located at <code class="highlighter-rouge">~/.kube/config</code>. It is a YAML format file, and each cluster block looks similar to this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">cluster</span><span class="pi">:</span>
    <span class="na">certificate-authority-data</span><span class="pi">:</span>
       <span class="s">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURPekNDQWlPZ0F3SUJBZ0lKQU9HTm9</span>
       <span class="s">PM1pNb3RGTUEwR0NTcUdTSWIzRFFFQkN3VUFNQmd4RmpBVUJnTlYKQkFNTURUTTBMakkwTk</span>
       <span class="s">M0eE9USXVORGt3SGhjTk1UZ3hNREF4TURnek5qVTFXaGNOTWpnd09USTRNRGd6TmpVMQpXa</span>
       <span class="s">kFZTVJZd0ZBWURWUVFEREEwek5DNHlORFF1TVRreUxqUTVNSUlCSWpBTkJna3Foa2lHOXcw</span>
       <span class="s">QkFRRUZBQU9DCkFROEFNSUlCQ2dLQ0FRRUE4YThJVytCUTM5c0p3OENyR0c5MmlYSUlWczN</span>
       <span class="s">QOElEVVJvOTMyVFVYcG05UWkwSUgKeVF0a2N1WEVpREhlbUgwK1RORHRmaFZ4cm9BRjQrVE</span>
       <span class="s">czR3JWZXc0YzgrZE0zNWJMY0lMRkl1L1UydlR4NkRXbgpDa2lwblhJVlc1QUxXa1hqRUh3N</span>
       <span class="s">TUvWnk3S0F2SjVjS0h5WnhMYzY1ZFZqVjJYNkQxRHhJRXh0c2dDVnB2R1gvCmRpK1ppZlJX</span>
       <span class="s">eFIwR0l5SkM3b29VaEVjcitvQVpMOFc2YklUMUlwcklXUGQ1eWhJck10MmpmaE42NWVkV1h</span>
       <span class="s">jYkoKNERQeEpIOVlDNFFqSC84OHNJdWVJMWo4S1NYQjdwbUJxMzJHYXZuaFp3K2M5bG1KSl</span>
       <span class="s">E5WjNZM2dla3lBUlZDRQpwUUU5T3BYR01QOCtCdng4QXdrQW9obE83RE1xQTlMaTl3QXExU</span>
       <span class="s">UlEQVFBQm80R0hNSUdFTUIwR0ExVWREZ1FXCkJCUXRaa3paWmxKSmZKMGZtbWNPZU9pR0VB</span>
       <span class="s">L3d1REJJQmdOVkhTTUVRVEEvZ0JRdFprelpabEpKZkowZm1tY08KZU9pR0VBL3d1S0VjcEJ</span>
       <span class="s">vd0dERVdNQlFHQTFVRUF3d05NelF1TWpRMExqRTVNaTQwT1lJSkFPR05vTzNaTW90RgpNQX</span>
       <span class="s">dHQTFVZEV3UUZNQU1CQWY4d0N3WURWUjBQQkFRREFnRUdNQTBHQ1NxR1NJYjNEUUVCQ3dVQ</span>
       <span class="s">UE0SUJBUUJnCjVndFpyY0FLUlFSYUJFZDFiVm5vRXpoZkxld2RXU2RYaEZGRXB6bjlzdG05</span>
       <span class="s">VGdVM2ZLREJ0NktUY3JKN2hqQWQKMUlUbUc1L2ExaUlDM29qQ2d3c1o3cnFmRlhkRGQzcVZ</span>
       <span class="s">GdjJySmZEN2ljeGV2c0NjWTdiS1hlYy9QdVgxQmxlMwo1amRjSWRkZnhqZ1M3K2dibCtQcG</span>
       <span class="s">owbm9OR0c5MUgydWtBWTlaei9FUHdZckhuV1V1V1o5Z3JTZlVGam1ZMTNWCjkxZmF0S2R2d</span>
       <span class="s">lU1blFPUXdkdThPVHlFRGk2blA4ckN4bEJjRW1hN3hkM3c5djI0NUlaRnd5QTJBMlR6emFJ</span>
       <span class="s">M04KYm0vMVNyL2tTNlZCSi9sZ2s3ampxRWFicmpFakluMlU4aGkzRkluRnBkZkZlUXhBaW5</span>
       <span class="s">JcUx5dGRzeXY5aFZVbQpKQ3luNW8yaGVjSTFsaDU3RFRtYQotLS0tLUVORCBDRVJUSUZJQ0</span>
       <span class="s">FURS0tLS0t</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s">https://54.229.190.254:443</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conjure-canonical-kubern-fc3</span>
<span class="na">contexts</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">context</span><span class="pi">:</span>
    <span class="na">cluster</span><span class="pi">:</span> <span class="s">conjure-canonical-kubern-fc3</span>
    <span class="na">user</span><span class="pi">:</span> <span class="s">conjure-canonical-kubern-fc3</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">conjure-canonical-kubern-fc3</span>
<span class="na">current-context</span><span class="pi">:</span> <span class="s">conjure-canonical-kubern-fc3</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Config</span>
<span class="na">preferences</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="na">users</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">conjure-canonical-kubern-fc3</span>
  <span class="na">user</span><span class="pi">:</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">sZVKhY7bZK8oG7vLkkOssNhTzKZlBmcG</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">admin</span>
</code></pre></div></div>

<!-- FEEDBACK -->
<div class="p-notification--information">
  <p class="p-notification__response">
    We appreciate your feedback on the documentation. You can 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/edit/master/pages/k8s/decommissioning.md" class="p-notification__action">edit this page</a> 
    or 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/issues/new" class="p-notification__action">file a bug here</a>.
  </p>
</div>
