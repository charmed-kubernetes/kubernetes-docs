<h1 id="add-a-helm-chart">Add a Helm Chart</h1>

<p>Now you have a cluster up and running with <a href="/kubernetes/docs/storage">storage</a>, you can install
applications in your cluster with <a href="https://helm.sh/"><strong>Helm</strong></a>. This handles the install
and <strong>Kubernetes</strong> configuration for a wide range of applications using
‘charts’.  We’ll take you through the steps:</p>

<h2 id="install-helm">Install Helm</h2>

<p><strong>Helm</strong> is available as a snap, so installing is as simple as:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>snap <span class="nb">install </span>helm
</code></pre></div></div>

<p><strong>Helm</strong> needs to install a component on the cluster also (the <code class="highlighter-rouge">Tiller</code>). It
gets the information on your cluster from <code class="highlighter-rouge">kubectl</code>, so if you have more than
one cluster, make sure you are switched to the correct <em>context</em>.</p>

<p>To install the ‘Tiller’, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm init
</code></pre></div></div>

<h2 id="chose-a-chart">Chose a Chart</h2>

<p><strong>Helm</strong>’s application packages are called charts. You can fetch the latest
list of charts with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> helm repo update
</code></pre></div></div>

<p>To see which repositories you are connected to:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm repo list
</code></pre></div></div>
<p>…which by default should list:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME  	URL                                             
stable	https://kubernetes-charts.storage.googleapis.com
local 	http://127.0.0.1:8879/charts                    
</code></pre></div></div>

<p>You can search these repositories for suitable charts. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> helm search jenkins
</code></pre></div></div>

<p>would return:</p>

<pre><code class="language-no-highlight">NAME          	CHART VERSION	APP VERSION	DESCRIPTION                                       
stable/jenkins	0.19.1       	2.121.3    	Open source continuous integration server. It s...
</code></pre>

<h2 id="deploying">Deploying</h2>

<p>Once you have selected the chart, you can install it with <strong>Helm</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm <span class="nb">install </span>stable/jenkins
</code></pre></div></div>

<p>Pay particular attention to the output. many <strong>Helm</strong> charts, including this one for
<a href="https://jenkins.io/"><strong>Jenkins</strong></a> include important information about how to connect or use the
newly installed pod.  In this case, you should see something similar to:</p>

<pre><code class="language-no-highlight">NOTES:
1. Get your 'admin' user password by running:
  &lt;pre&gt;
  printf $(kubectl get secret --namespace default hipster-orangutan-jenkins -o jsonpath="{.data.jenkins-admin-password}" | base64 --decode);echo
  &lt;/pre&gt;
2. Get the Jenkins URL to visit by running these commands in the same shell:
  NOTE: It may take a few minutes for the LoadBalancer IP to be available.
        You can watch the status of by running 'kubectl get svc --namespace default -w hipster-orangutan-jenkins'
  &lt;pre&gt;
  export SERVICE_IP=$(kubectl get svc --namespace default hipster-orangutan-jenkins --template "")
  echo http://$SERVICE_IP:8080/login
  &lt;/pre&gt;

3. Login with the password from step 1 and the username: admin
</code></pre>

<p>As mentioned in the above notes, the jenkins chart uses a loadbalancer which requires a
public IP address. Allocating IP addresses is done through the underlying cloud, so the
process could take anywhere from no time at all to a couple of minutes.</p>

<p>You can confirm that a new pod has been created with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm list
</code></pre></div></div>

<p>… which should return a list of all the <strong>Helm</strong> charts which have been installed</p>

<pre><code class="language-no-highlight">NAME                        REVISION     	UPDATED                                  	STATUS  	        CHART               NAMESPACE
hipster-orangutan	1       	              Thu Nov  8 14:41:33 2018   	DEPLOYED    	jenkins-0.19.1	default  
</code></pre>

<h2 id="accessing">Accessing</h2>

<p>Following the notes displayed when we installed the chart, we can first obtain the
password:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nb">printf</span> <span class="k">$(</span>kubectl get secret <span class="nt">--namespace</span> default hipster-orangutan-jenkins <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.jenkins-admin-password}"</span> | <span class="nb">base64</span> <span class="nt">--decode</span><span class="k">)</span><span class="p">;</span><span class="nb">echo</span>
</code></pre></div></div>

<p>Which returns a value like <code class="highlighter-rouge">4oEUJeMvpu</code>. This is the password for the admin user. Now
we just need the IP address.</p>

<p>To check whether this has been assigned yet, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get svc <span class="nt">--namespace</span> default hipster-orangutan-jenkins
</code></pre></div></div>

<p>If the <em>External_IP</em> is still shown as pending, you will have to try back later. If a value is
listed there, run the commands from the previous output to get the full URL.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">SERVICE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl get svc <span class="nt">--namespace</span> default hipster-orangutan-jenkins <span class="nt">--template</span> <span class="s2">""</span><span class="k">)</span>
<span class="nb">echo </span>http://<span class="nv">$SERVICE_IP</span>:8080/login
</code></pre></div></div>

<p><img src="https://assets.ubuntu.com/v1/80a62903-aws-002.png" alt="jenkins login page" /></p>

<p>Enter ‘admin’ as the user name, and the password we retrieved earlier…</p>

<p><img src="https://assets.ubuntu.com/v1/fb6a502d-aws-003.png" alt="jenkins login page" /></p>

<p>Congratulations - you have now deployed <strong>Jenkins</strong> with <strong>Helm</strong></p>

<!-- IMAGES -->

<!-- LINKS -->

<!-- FEEDBACK -->
<div class="p-notification--information">
  <p class="p-notification__response">
    We appreciate your feedback on the documentation. You can 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/edit/master/pages/k8s/helm.md" class="p-notification__action">edit this page</a> 
    or 
    <a href="https://github.com/charmed-kubernetes/kubernetes-docs/issues/new" class="p-notification__action">file a bug here</a>.
  </p>
</div>
